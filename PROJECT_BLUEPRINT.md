# Nexus AI: Project Blueprint & Technical Overview

This document provides a comprehensive technical overview of the Nexus AI application, intended for developers and technical stakeholders.

## 1. Project Goal

Nexus AI is a production-ready, cyberpunk-themed AI chat application built as a portfolio-quality project. The core focus is on stability, a feature-rich user experience, and robust observability.

## 2. Technology Stack

- **Backend:** Ruby on Rails 8.1
- **Database:** PostgreSQL
- **Cache & Jobs:** Redis (with Solid Queue)
- **Frontend:** Hotwire (Turbo, Stimulus), Tailwind CSS
- **Authentication:** Devise
- **Authorization:** Pundit
- **AI Integration:** Google Gemini API

## 3. Core Features

- **Multi-Persona System:** Users can start chat sessions with different AI personas (e.g., "Developer," "Creative," "Analyst"), each with a unique system instruction that guides the AI's behavior.
- **Real-Time Chat Interface:** Messages from the user and AI are broadcast in real-time via Action Cable.
- **Smart Titles:** The title of a chat session is automatically generated by an AI job (`GenerateTitleJob`) after the second user message is sent.
- **Session Export:** Users can export their chat sessions, including all messages and feedback, as a JSON file. This is handled by an asynchronous job (`ExportChatSessionJob`).
- **In-App "App Launcher" Modal:** A UI element for accessing additional tools and features (currently a placeholder).

## 4. System Architecture

### Models

- `User`: Manages user accounts via Devise. Includes an `admin` flag and a `features` JSONB column for feature flagging (e.g., `pro_session_analytics`).
- `Persona`: Defines the AI's personality, including its name, icon, and system instruction.
- `ChatSession`: Represents a single conversation. Belongs to a `User` and a `Persona`.
- `Message`: A single message in a chat, belonging to a `ChatSession`. Has a `role` (`user` or `assistant`).
- `Feedback`: Allows users to submit feedback on chat sessions.
- `AuditEvent`: Logs significant user actions for admin review (e.g., `created_session`, `exported_session`).

### Controllers

- `PagesController`: Handles static pages like the `nexus` homepage.
- `ChatSessionsController`: Manages the lifecycle of chat sessions (CRUD, export).
- `MessagesController`: Handles the creation of user messages and triggers the AI response job.
- `Admin::DashboardsController`: Provides a view for monitoring application metrics.
- `HealthController`: Exposes a `/health` endpoint to check the status of the database, Redis, and AI API key.

### Background Jobs

- `AiResponseJob`: The core job for interacting with the Gemini API. It includes a robust manual retry loop with exponential backoff to handle transient API errors.
- `GenerateTitleJob`: Asynchronously generates a title for a chat session.
- `ExportChatSessionJob`: Asynchronously generates a JSON export of a chat session.

### Services

- `Ai::GenerateResponseService`: A dedicated service that encapsulates the logic for making calls to the Gemini API.
- `DashboardService`: Gathers and calculates metrics for the admin dashboard.
- `ErrorNotifierService`: A centralized service for reporting errors (currently a placeholder for integration with a service like Sentry or Bugsnag).

### Authentication & Authorization

- **Authentication** is handled by **Devise**.
- **Authorization** is handled by **Pundit**. Policies are in place for `ChatSession` and `Message` to ensure users can only access their own data.

## 5. Observability & Stability

- **Structured Logging:** A custom `ApiEventLogger` writes structured JSON events to `log/api_events.log`. This allows for detailed analysis of job performance, API calls, and errors.
- **Admin Dashboard:** An admin-only dashboard at `/admin/dashboard` displays key Service Level Objectives (SLOs), including:
  - **p95 Latency:** The 95th percentile latency of AI response jobs.
  - **Success Rate:** The percentage of AI response jobs that succeed.
- **Error Handling:**
  - Custom 404 and 500 error pages are implemented.
  - The 500 error page includes a "Report this error" button that allows users to submit feedback with pre-filled context.
  - The `AiResponseJob` uses a robust retry mechanism to ensure resilience.

## 6. Frontend & UI

- **Theme:** "Cyber-Midnight" - a dark theme with a neon-cyan accent color.
- **Fonts:** `Rajdhani` for headings and `Inter` for body text.
- **Interactivity:** The frontend is powered by **Hotwire** (Turbo and Stimulus) for real-time updates and interactive elements.

## 7. Current Status

The application is in a stable state. All tests are passing, and all critical bugs identified during development have been resolved. The core functionality is implemented and working as expected.
