<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <title>Nexus AI - Minimal Futuristic</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#ff6b35">
    <meta name="description" content="Nexus AI - Your gateway to multiple LLM providers">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Fonts: Rajdhani (Tech) & Inter (Body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons & Syntax Highlighting -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Vite Assets: Tailwind CSS + JavaScript -->
    <link rel="stylesheet" href="/tailwind.css">
    <script type="module" src="http://localhost:3036/vite-dev/@vite/client"></script>
    <script type="module" src="http://localhost:3036/vite-dev/entrypoints/application.js"></script>
    
    <!-- Custom Overrides (if needed - loaded after Tailwind) -->
    <!-- <div class="comment">futuristic-minimal.css disabled - using Tailwind utilities instead</div> -->
  </head>

  <body class="h-full flex flex-col antialiased">

    <!-- Flash Messages (fixed at top for all states) -->
    <% flash.each do |type, msg| %>
      <div class="fixed top-4 right-4 z-50 px-4 py-3 rounded-lg border-2 border-cyber-accent bg-white text-cyber-accent shadow-glow-lg font-semibold">
        <%= msg %>
      </div>
    <% end %>

    <div class="flex flex-1 overflow-hidden" data-controller="mobile-menu">
       <!-- SIDEBAR (Only if logged in) -->
       <% if user_signed_in? %>
         <%= render "shared/sidebar" %>
         <!-- Mobile Menu Overlay (shown on small screens) -->
         <div class="fixed inset-0 bg-black/30 hidden lg:hidden z-30 transition-opacity duration-200" data-mobile-menu-target="overlay" data-action="click->mobile-menu#close"></div>
         <div class="flex-1 h-full relative min-w-0 w-full flex flex-col overflow-hidden lg:ml-0">
           <!-- Mobile Header with Menu Button -->
           <div class="lg:hidden flex items-center justify-between bg-white border-b border-neutral-200 p-3 z-10">
             <button data-action="click->mobile-menu#toggle" class="p-2 rounded hover:bg-neutral-100 transition-colors" title="Toggle menu">
               <i data-lucide="menu" class="w-5 h-5 text-neutral-900"></i>
             </button>
             <a href="<%= root_path %>" class="flex items-center gap-2">
               <i data-lucide="sparkles" class="w-4 h-4 text-neutral-900"></i>
               <span class="text-sm font-semibold text-neutral-900">Nexus</span>
             </a>
             <div class="w-10"></div>
           </div>
           <main class="flex-1 bg-cyber-bg overflow-y-auto">
             <%= yield %>
           </main>
         </div>
       <% else %>
         <main class="flex-1 h-full relative min-w-0 w-full flex flex-col overflow-hidden bg-cyber-bg overflow-y-auto">
           <%= yield %>
         </main>
       <% end %>
     </div>

    <script>
      // Initialize icons on page load and after Turbo navigation
      function initializeIcons() {
        if(window.lucide) {
          lucide.createIcons();
        }
      }
      
      // Run on initial page load
      document.addEventListener('DOMContentLoaded', initializeIcons);
      
      // Run after Turbo page loads
      document.addEventListener('turbo:load', initializeIcons);
      
      // Ensure form buttons are clickable
      document.addEventListener('turbo:load', () => {
        document.querySelectorAll('button, a[href], input[type="submit"]').forEach(el => {
          el.style.cursor = 'pointer';
          el.style.pointerEvents = 'auto';
        });
      });
    </script>
  </body>
</html>
